<div class="filters" x-data="taskFilters()">
    <label>Project:
        <select x-model="project" @change="filterTasks()">
            <option value="">All</option>
            <template x-for="p in projects" :key="p">
                <option x-text="p"></option>
            </template>
        </select>
    </label>
    <label>Tag:
        <select x-model="tag" @change="filterTasks()">
            <option value="">All</option>
            <template x-for="t in tags" :key="t">
                <option x-text="t"></option>
            </template>
        </select>
    </label>
</div>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Description</th>
            <th>Project</th>
            <th>Notification Date</th>
            <th>Tags</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Set Notification Date</th>
        </tr>
    </thead>
    <tbody id="task-rows">
    {{ range . }}
        <tr x-show="(project === '' || project === '{{ .Project }}') && (tag === '' || ({{ printf "%#v" .Tags }}.includes(tag)))">
            <td>{{ .ID }}</td>
            <td>{{ .Description }}</td>
            <td>{{ .Project }}</td>
            <td>{{ .NotificationDate }}</td>
            <td>{{ range .Tags }}<span class="tag">{{ . }}</span> {{ end }}</td>
            <td>{{ .Priority }}</td>
            <td>{{ .Status }}</td>
            <td>
                <form hx-post="/api/set-notification-date" hx-params="*" hx-target="closest tr" hx-swap="outerHTML">
                    <input type="hidden" name="uuid" value="{{ .UUID }}">
                    <input type="datetime-local" name="notification_date" value="{{ .NotificationDate }}">
                    <button type="submit">Set</button>
                </form>
            </td>
        </tr>
    {{ else }}
        <tr><td colspan="8">No tasks found.</td></tr>
    {{ end }}
    </tbody>
</table>
<script>
function taskFilters() {
    // These will be replaced by server-side rendering in a real app
    return {
        project: '',
        tag: '',
        projects: Array.from(new Set(Array.from(document.querySelectorAll('#task-rows tr td:nth-child(3)')).map(td => td.textContent).filter(Boolean))),
        tags: Array.from(new Set(Array.from(document.querySelectorAll('#task-rows tr td:nth-child(5) .tag')).map(td => td.textContent).filter(Boolean))),
        filterTasks() {
            // Alpine x-show handles filtering
        }
    }
}
</script>
